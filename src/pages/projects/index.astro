---
import { getCollection } from "astro:content";

import { SquareArrowRightIcon, ToolCaseIcon } from "@lucide/astro";

import ProjectCover from "@/components/project-cover.astro";
import { DISABLED_PROJECTS, ICON_SIZE } from "@/scripts/constants";
import TechList from "@/components/tech-list.astro";
import ContentDate from "@/components/content-date.astro";
import BaseLayout from "@/layouts/base-layout.astro";
import Header from "@/components/header.astro";

const WITH_VIDEOS = [
  // "racecar",
  "cuda-path-tracer",
  "mini-minecraft",
  "door",
];

const projects = (await getCollection("projects"))
  .filter((project) => !DISABLED_PROJECTS.includes(project.id))
  .sort((a, b) => a.data.order - b.data.order);

const description =
  "Write-ups and technical breakdowns of some of my favorite projects.";
---

<BaseLayout
  meta={{
    kind: "route",
    title: "Portfolio",
    description,
    ogImageParams: "Graphics programming, games, and sometimes art.",
  }}
>
  <Header links={[]} description={description} maxColumns={2}>
    <Fragment slot="title">
      Portfolio <ToolCaseIcon
        aria-hidden="true"
        class="stroke-icon md:size-9"
      />
    </Fragment>
  </Header>

  <main
    class="mx-auto grid max-w-[calc(1300px+var(--spacing-pad-4))] grid-cols-1 gap-y-pad-4 p-pad-2 sm:mt-pad-2 sm:grid-cols-2 sm:gap-y-0"
  >
    {
      projects.map(({ id, data: { name, blurb, metadata, cover } }) => (
        <section
          aria-labelledby={id}
          class="group relative rounded-3xl transition-colors duration-200 desktop:p-pad desktop:hover:bg-sweater-9 not-dark:desktop:hover:bg-sweater-2 lg:p-pad-2"
        >
          <ProjectCover
            id={id}
            cover={cover}
            useVideo={WITH_VIDEOS.includes(id) ? { small: true } : null}
            class="mb-pad overflow-hidden rounded-2xl"
          />

          <h2
            id={id}
            class="mb-2 flex items-center justify-between text-xl leading-[1.1] font-bold text-link-primary transition-colors group-hover:text-link-primary-hover sm:text-2xl lg:mb-1"
          >
            <a
              href={`/projects/${id}`}
              class="after:absolute after:inset-0 after:z-1 after:rounded-3xl"
            >
              {name}
            </a>

            <SquareArrowRightIcon
              aria-hidden="true"
              size={ICON_SIZE}
              class="shrink-0 stroke-icon sm:hidden"
            />
          </h2>

          <div class="mb-1.5 grid grid-cols-1 gap-x-pad gap-y-1.5 *:text-link-secondary *:transition-colors *:group-hover:text-link-secondary-hover sm:mb-pad sm:text-lg lg:grid-cols-2">
            <ContentDate date={metadata.date} class="leading-none" />
            <TechList tech={metadata.tech} class="*:leading-none" />
          </div>

          <p class="hidden transition-colors group-hover:text-inherit desktop:[display:inherit]">
            {blurb}
          </p>
        </section>
      ))
    }
  </main>
</BaseLayout>
