---
import type { GetStaticPaths } from "astro";
import { getCollection, getEntry, render } from "astro:content";
import { Image } from "astro:assets";

import MainLayout from "@/layouts/main-layout.astro";
import ProjectCover from "@/components/project-cover.astro";
import TableOfContents from "@/components/table-of-contents.astro";

import Anchor from "@/components/mdx/anchor.astro";
import Aside from "@/components/mdx/aside.astro";
import H2 from "@/components/mdx/h2.astro";
import H3 from "@/components/mdx/h3.astro";
import Link from "@/components/link.astro";
import { Wrench } from "lucide-astro";

export const getStaticPaths = (async () => {
  const projects = await getCollection("projects");
  return projects.map((project) => {
    return { params: { id: project.id } };
  });
}) satisfies GetStaticPaths;

const { id } = Astro.params;
const project = await getEntry("projects", id)!;

// Destructure everything
const {
  data: {
    name,
    blurb,
    metadata: { tech, link, sourceHref },
    cover,
  },
} = project;

const { Content, headings } = await render(project);
---

<MainLayout meta={{ kind: "project", project }}>
  <ProjectCover
    id={id}
    cover={cover}
    useVideo={{ small: false }}
    class="mt-12 overflow-hidden rounded-xl"
  />

  <h1 class="pt-8 text-3xl">{name}</h1>

  <p class="pt-2 text-sweater-2">{blurb}</p>

  <div class="mb-12 flex gap-7">
    <article class="mt-12 w-full space-y-12">
      <section class="space-y-10">
        <div class="grid grid-cols-2 gap-x-4 gap-y-2">
          <div class="flex gap-4 rounded-xl bg-sweater-9 p-4">
            <Wrench class="shrink-0" />

            <div>
              <h2>Tech</h2>
              <p>{tech.sort().join(", ")}</p>
            </div>
          </div>

          {
            link ? (
              <div>
                <h2>{link.text}</h2>
                <Link href={link.href} target="_blank">
                  {link.href.substring(8)}
                </Link>
              </div>
            ) : null
          }

          {
            sourceHref ? (
              <div>
                <h2>Source</h2>
                <Link href={sourceHref} target="_blank">
                  Visit GitHub repo
                </Link>
              </div>
            ) : null
          }
        </div>
      </section>

      <section class="flex gap-8">
        <div class="max-w-[650px] space-y-6">
          <Content
            components={{
              h2: H2,
              h3: H3,
              blockquote: Aside,
              a: Anchor,
              img: Image,
            }}
          />
        </div>

        <!-- <TableOfContents headings={headings} /> -->
      </section>
    </article>
  </div>
</MainLayout>
