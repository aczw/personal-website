---
import { Image } from "astro:assets";

import ContentLayout from "@/layouts/content-layout.astro";

import notFound from "@/assets/not-found.png";

import Link from "@/components/link.astro";

Astro.response.status = 404;
Astro.response.statusText = "Page not found";

let fun = [
  "soitgoes",
  "aczw",
  "newfaces",
  "doitagain",
  "tilinfinity",
  "suboptimal",
  "promiseme",
  "allitcosts",
];

let pick = fun[Math.floor(Math.random() * fun.length)];
let offset = Math.floor(Math.random() * pick.length);
let scrambled = pick.slice(offset) + pick.slice(0, offset);
---

<ContentLayout
  minHeight
  className="flex flex-col items-center justify-center"
  meta={{
    kind: "route",
    title: "404",
    description: "Sorry, this page doesn't exist.",
    ogImageParams: "Page not found.",
  }}
>
  <Image
    src={notFound}
    alt="Page not found"
    class="mb-16 w-[clamp(400px,80%,500px)] animate-fade [--order:0]"
  />

  <section class="flex flex-col items-center gap-3">
    <p class="animate-fade [--order:1]">
      <Link href="https://twitter.com/sawaratsuki1004" target="_blank">Source.</Link>
      <span class="subtitle">Sorry, page not found~</span>
    </p>

    <p
      id="scroll"
      aria-hidden="true"
      data-scrambled={scrambled}
      class="berkeley w-fit animate-fade rounded-lg bg-sweater-9 px-2 py-0.5 italic text-sweater-6 [--order:2]"
    >
      {scrambled}
    </p>
  </section>
</ContentLayout>

<script>
  // for some reason, whitespace is added to the front and end of the word, so we can't
  // use scroll.textContent directly at first. instead, store the scrambled word in the dataset
  const scroll = document.getElementById("scroll");

  // if the element doesn't exist, then the 404 component wasn't rendered and the post exists
  if (scroll) {
    let text = scroll.dataset.scrambled!;

    // remove it because now it's unnecessary and looks ugly lol
    delete scroll.dataset.scrambled;

    setInterval(() => {
      scroll.textContent = text.slice(1) + text[0];
      text = scroll.textContent;
    }, 500);
  }
</script>
