---
import type { ImageMetadata } from "astro";
import { Image } from "astro:assets";

import { ArrowLeftIcon, ArrowRightIcon, InfoIcon } from "@lucide/astro";

import BaseLayout from "@/layouts/base-layout.astro";
import Header from "@/components/header.astro";
import { ICON_SIZE } from "@/scripts/constants";

import imageSpider from "@/assets/about/spider.jpg";
import imagePizza from "@/assets/about/pizza.jpg";
import imageDante from "@/assets/about/dante.jpg";
import imageSomisomi from "@/assets/about/somisomi.jpg";
import imageBirthday from "@/assets/about/birthday.jpg";
import imageAsa from "@/assets/about/asa.jpg";

type AboutPicture = {
  id: string;
  imageMetadata: ImageMetadata;
  alt: string;
};

const ABOUT_PICTURES: AboutPicture[] = [
  {
    id: "spider",
    imageMetadata: imageSpider,
    alt: "Me at 5 years old wearing a paper hat holding a paper spider.",
  },
  {
    id: "pizza",
    imageMetadata: imagePizza,
    alt: "Me at 5 years old being fed pizza. I'm wearing a yellow jacket.",
  },
  {
    id: "dante",
    imageMetadata: imageDante,
    alt: "Me being attacked by my best friend's dog, Dante.",
  },
  {
    id: "somisomi",
    imageMetadata: imageSomisomi,
    alt: "Me looking very pleased holding Somisomi ice cream.",
  },
  {
    id: "birthday",
    imageMetadata: imageBirthday,
    alt: "Celebrating my 20th birthday.",
  },
  {
    id: "asa",
    imageMetadata: imageAsa,
    alt: "Me dressed up as Asa from Chainsaw Man for Halloween.",
  },
];

const description = "More about who I am";
---

<BaseLayout
  meta={{
    kind: "route",
    title: "About",
    description: description + ".",
    ogImageParams: description,
  }}
>
  <Header links={[]} />

  <main>
    <article class="space-y-pad-4">
      <hgroup
        class="mx-auto grid w-full grid-cols-1 gap-x-pad-2 px-pad-2 pt-pad-2 desktop:w-4/5 desktop:px-pad md:grid-cols-2 lg:w-(--real-header-w) lg:pt-pad-3 xl:gap-x-pad-4"
      >
        <h1 class="flex items-center gap-x-pad text-5xl font-bold text-heading">
          About <InfoIcon size={2 * ICON_SIZE} class="stroke-icon" />
        </h1>
        <p class="max-w-(--content-w) italic">
          Pushing pixels, carving bridges
        </p>
      </hgroup>

      <div
        class="mx-auto grid w-full grid-cols-1 gap-x-pad-2 px-pad-2 desktop:w-4/5 desktop:px-pad md:grid-cols-2 lg:w-(--real-header-w) xl:gap-x-pad-4"
      >
        <div class="space-y-pad-2">
          <p>
            Hi! I'm a fourth year student in the Digital Media Design major at
            UPenn. I'm interested in computer graphics, game engine development,
            and real-time rendering.
          </p>
          <p>
            I help run UPGRADE, our game dev club, and am part of the CG@Penn
            student board. Previously I was at Snap.
          </p>
          <p>
            I love making and designing things. For fun I like to run, create
            playlists, read manga, and ride SEPTA. I strongly believe in shared
            spaces and self-expression on the web.
          </p>
          <p>
            You can find ways to reach me and my resumé below. Thanks for
            visiting!! (〜￣▽￣)〜
          </p>
        </div>

        <div class="h-fit space-y-pad">
          <div
            class="flex gap-x-pad *:w-1/2 *:rounded-xl *:bg-sweater-9 *:p-pad *:leading-none *:transition-colors *:hover:bg-sweater-8"
          >
            <button id="prev-picture" class="group"
              ><span
                class="flex w-full items-center justify-between gap-x-pad transition-transform group-active:scale-97"
                ><ArrowLeftIcon
                  aria-hidden="true"
                  size={ICON_SIZE}
                  class="stroke-icon"
                />
                Previous
              </span>
            </button>

            <button id="next-picture" class="group"
              ><span
                class="flex w-full items-center justify-between gap-x-pad transition-transform group-active:scale-97"
              >
                Next <ArrowRightIcon
                  aria-hidden="true"
                  size={ICON_SIZE}
                  class="stroke-icon"
                />
              </span>
            </button>
          </div>

          <div
            id="pictures"
            class="relative rounded-xl *:overflow-hidden *:rounded-xl"
          >
            {
              ABOUT_PICTURES.map(({ id, imageMetadata, alt }, index) => (
                <Image
                  id={id}
                  src={imageMetadata}
                  alt={alt}
                  loading={index === 0 ? "eager" : "lazy"}
                  class:list={[
                    "absolute inset-0 origin-top",
                    { "scale-40 opacity-0 blur-2xl": index !== 0 },
                  ]}
                  data-umami-event="clicked-about-picture"
                  data-umami-event-id={id}
                />
              ))
            }
          </div>
        </div>
      </div>
    </article>
  </main>
</BaseLayout>

<script>
  const images = document.getElementById("pictures")!.children;
  const firstImage = images.item(0)!;
  const lastImage = images.item(images.length - 1)!;

  let activeImage = firstImage;

  function transitionActiveImage(target: Element) {
    activeImage
      .animate(
        [{ scale: 0.4, opacity: 0.0, filter: "blur(var(--blur-2xl))" }],
        {
          duration: 225,
          easing: "cubic-bezier(0.87, 0, 0.13, 1)",
          fill: "forwards",
        },
      )
      .addEventListener("finish", (ev) => {
        const animation = ev.currentTarget as Animation;
        animation.commitStyles();
        animation.cancel();
      });

    target
      .animate([{ scale: 1.0, opacity: 1.0, filter: "none" }], {
        duration: 200,
        easing: "ease-in-out",
        fill: "forwards",
      })
      .addEventListener("finish", (ev) => {
        const animation = ev.currentTarget as Animation;
        animation.commitStyles();
        animation.cancel();
        activeImage = target;
      });
  }

  document
    .getElementById("prev-picture")!
    .addEventListener("click", () =>
      transitionActiveImage(
        activeImage.previousElementSibling ?
          activeImage.previousElementSibling
        : lastImage,
      ),
    );

  document
    .getElementById("next-picture")!
    .addEventListener("click", () =>
      transitionActiveImage(
        activeImage.nextElementSibling ?
          activeImage.nextElementSibling
        : firstImage,
      ),
    );
</script>
