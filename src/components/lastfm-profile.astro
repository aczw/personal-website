---
import api from "@/utils/api";

interface LastFmProfile {
  user: {
    name: string;
    age: string;
    subscriber: string;
    realname: string;
    bootstrap: string;
    playcount: string;
    artist_count: string;
    playlists: string;
    track_count: string;
    album_count: string;
    image: {
      size: "small" | "medium" | "large" | "extralarge";
      "#text": string;
    }[];
    registered: {
      unixtime: string;
      "#text": number;
    };
    country: string;
    gender: string;
    url: string;
    type: string;
  };
}

interface LastFmWeeklyTracks {
  weeklytrackchart: {
    track: {
      artist: { mbid: string; "#text": string };
      image: { size: "small" | "medium" | "large"; "#text": string }[];
      mbid: string;
      url: string;
      name: string;
      "@attr": {
        rank: string;
      };
      playcount: string;
    }[];
    "@attr": {
      from: string;
      user: string;
      to: string;
    };
  };
}

const { user: profile } = await api<LastFmProfile>(
  `http://ws.audioscrobbler.com/2.0/?method=user.getinfo&user=ashzw&api_key=${
    import.meta.env.LASTFM_API_KEY
  }&format=json`,
);

const { weeklytrackchart: tracks } = await api<LastFmWeeklyTracks>(
  `https://ws.audioscrobbler.com/2.0/?method=user.getweeklytrackchart&user=ashzw&api_key=${
    import.meta.env.LASTFM_API_KEY
  }&format=json`,
);

const topThree = tracks.track.slice(0, 3);
---

<div
  class="col-span-4 row-span-2 flex xs:h-[194px] xs:max-w-[400px] flex-col justify-between space-y-3 rounded-xl bg-sweater-9 p-5 text-sweater-1 2xl:h-[244px] 2xl:max-w-[500px] 2xl:p-8"
>
<h4 class="w-fit font-bold text-sweater-2">
      Last.fm profile
    </h4>
  <p>
    I really like music and <a
      href={profile.url}
      target="_blank"
      class="text-sweater-3 transition-colors hover:text-sweater-1 hover:underline"
      >I really like tracking it.</a
    > I currently have {profile.playcount}
     total scrobbles.
  </p>
  <p class="xs:line-clamp-2">
    My top tracks this week are
    <a
        href={topThree[0].url}
        target="_blank"
        class="text-sweater-3 hover:text-sweater-1 hover:underline transition-colors"
        >{topThree[0].name}</a
      > ({topThree[0].playcount} times),
    <a
        href={topThree[1].url}
        target="_blank"
        class="text-sweater-3 hover:text-sweater-1 hover:underline transition-colors"
        >{topThree[1].name}</a
      > ({topThree[1].playcount} times), and
    <a
        href={topThree[2].url}
        target="_blank"
        class="text-sweater-3 hover:text-sweater-1 hover:underline transition-colors"
        >{topThree[2].name}</a
      > ({topThree[2].playcount} times).
  </p>
</div>
