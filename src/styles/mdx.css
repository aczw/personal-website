@layer base {
  :root {
    /* Results in roughly 80 characters per line. */
    --content-w: 525px;
  }
}

/* Only style elements rendered from MDX */
@utility mdx {
  @apply grid space-y-pad-2;

  grid-template-columns: minmax(0, var(--content-w)) 1fr;

  > * {
    @apply col-start-1;

    /* Style the last element in the content only if there are footnotes */
    &:nth-last-child(2):has(+ section[data-footnotes]) {
      @apply mb-6! border-b-(length:--border-w) border-style pb-pad;

      @variant sm {
        @apply mb-12!;
      }
    }

    /* Disable spacing before rendered LaTeX because MathJax provides
     * its own margin styling (which I override) */
    &:has(+ mjx-container) {
      @apply mb-0;
    }
  }

  h2:has(+ h3) {
    @apply mb-pad;
  }

  /* In general, all media should have full width. */
  img,
  video,
  iframe {
    @apply rounded-lg;
  }

  .mdx-outdent * {
    @apply rounded-none;

    @variant desktop {
      @apply rounded-lg;
    }
  }

  /* Disable on mobile */
  @media (hover: hover) {
    img:not([data-no-zoom]) {
      @apply transition-transform active:scale-97;

      cursor: zoom-in;
    }
  }

  /* Inline code should have some padding and unique background color */
  code {
    @apply rounded-md bg-sweater-9 px-1.25 py-0.5 maple wrap-break-word;

    @variant not-dark {
      @apply bg-sweater-2;
    }
  }

  del {
    @apply cursor-not-allowed text-sweater-6 line-through;

    @variant not-dark {
      @apply text-sweater-4;
    }
  }

  ul {
    @apply ml-pad-2 list-outside space-y-1;

    list-style-type: "âž”";
  }

  ol {
    @apply ml-pad-2 list-outside space-y-0.5;

    list-style-type: decimal;
  }

  li {
    @apply pl-2;

    &::marker {
      @apply text-sweater-5;

      @variant not-dark {
        @apply text-sweater-6;
      }
    }
  }

  figcaption {
    @apply mt-1 text-sm text-heading *:inline;

    /* Draw a little arrow before the caption */
    &::before {
      @apply scale-90;

      content: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNkNmQzZmYiIHN0cm9rZS13aWR0aD0iMyIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0ibHVjaWRlIGx1Y2lkZS1jb3JuZXItZG93bi1yaWdodC1pY29uIGx1Y2lkZS1jb3JuZXItZG93bi1yaWdodCI+PHBvbHlsaW5lIHBvaW50cz0iMTUgMTAgMjAgMTUgMTUgMjAiLz48cGF0aCBkPSJNNCA0djdhNCA0IDAgMCAwIDQgNGgxMiIvPjwvc3ZnPg==") /
        "";

      translate: 0px calc(var(--spacing) * 0.6);
      display: inline-block;
      padding-right: 3.5px;
      opacity: 90%;

      @variant not-dark {
        content: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2IiBmaWxsPSJub25lIj4KPHBhdGggZD0iTTEwIDYuNjY2NjdMMTMuMzMzMyAxMEwxMCAxMy4zMzMzIiBzdHJva2U9IiM0ODQzOTAiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+CjxwYXRoIGQ9Ik0yLjY2NjYzIDIuNjY2NjdWNy4zMzMzNEMyLjY2NjYzIDguMDQwNTggMi45NDc1OCA4LjcxODg2IDMuNDQ3NjcgOS4yMTg5NkMzLjk0Nzc3IDkuNzE5MDUgNC42MjYwNSAxMCA1LjMzMzI5IDEwSDEzLjMzMzMiIHN0cm9rZT0iIzQ4NDM5MCIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4KPC9zdmc+") /
          "";
      }
    }
  }

  table {
    @apply mdx-outdent border-y-(length:--border-w) border-style;

    thead {
      @apply border-b-(length:--border-w) border-style bg-sweater-9/70 font-bold text-heading not-dark:bg-sweater-2/70;

      th {
        @apply px-pad-2 py-0.5 not-last:border-r-(length:--border-w) not-last:border-style;
      }
    }

    tbody {
      tr {
        @apply not-last:border-b-(length:--border-w) not-last:border-style even:bg-sweater-9/35 not-dark:even:bg-sweater-2/35;

        td {
          @apply px-pad-2 py-0.5 leading-snug not-last:border-r-(length:--border-w) not-last:border-style;
        }
      }
    }

    @variant desktop {
      @apply border-x-(length:--border-w);
    }
  }

  /* Target auto-generated footnotes */
  section[data-footnotes] {
    @apply mb-0! border-t-(length:--border-w) border-style pt-pad;

    /* MDX generates a "Footnotes" heading. Make it screen reader only */
    > h2#footnote-label {
      @apply sr-only;
    }

    > ol {
      @apply space-y-1.5;

      /* The following two selectors are to make sure back ref arrows are 
         * inline with the text */
      > li > p:has(> a[data-footnote-backref]) {
        display: inline;
      }

      a[data-footnote-backref] {
        display: inline;

        > svg {
          @apply -translate-y-0.5;

          stroke-width: 3px;
          display: inline;
        }
      }
    }
  }
}

@utility mdx-outdent {
  @apply -ml-pad-2;

  width: calc(100% + var(--spacing-pad-4));

  > figcaption {
    @apply ml-pad-2;
  }
}

@utility mdx-bleed {
  @apply col-span-2;
}

/* @utility mdx-bleed {
  @media (width >= 1150px) {
    @apply -ml-pad-2;

    width: calc(100% + var(--spacing-pad-4));

    > figcaption {
      @apply ml-pad-2;
    }
  }
}

@utility mdx-bleed-wide {
  @apply col-span-1 mdx-bleed sm:col-span-2;
} */
